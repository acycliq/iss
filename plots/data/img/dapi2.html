<!DOCTYPE html>
<html style="height: 100%; margin: 0;"
<head>
<title> Title goes here </title>
<meta name="viewpoint" content="width=device-width, initial-scale=1.0">

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin=""/> 
 <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
   crossorigin=""></script>

</head>
<body style="height:100%; margin:0;">

    <div id="map" style="width: 100%; height: 100%; background: #888888; margin:0;"></div>
          <button id="fly1">Fly to 1</button>
      <button id="fly2">Fly to 2</button>

      <br />

      <div id="container"></div>
    
    <script>
        
            ////////////////////////////////////////////////////////////////////////////
    // Conversion from (x, y) raster image coordinates to equivalent of latLng
    // Taken from Leaflet tutorial "Non-geographical maps"
    // http://leafletjs.com/examples/crs-simple/crs-simple.html
    ////////////////////////////////////////////////////////////////////////////
        var yx = L.latLng;

        var xy = function(x, y) {
          if (L.Util.isArray(x)) { // When doing xy([x, y]);
            return yx(x[1], x[0]);
          }
          return yx(y, x); // When doing xy(x, y);
        };
        
        var minZoom = 0;
        var maxZoom = 6;
        var img = [
          16384, // original width of image `karta.jpg` => x / ~longitude (0 is left, 3831 is right)
          16384 // original height of image => y / ~ reverse of latitude (0 is top, 3101 is bottom)
        ];

        /**
         * Tile 0/0/0 is 256 x 256 px, and so are all other tiles.
         * See https://stackoverflow.com/questions/34638887/leaflet-custom-coordinates-on-image
         * http://leafletjs.com/reference-1.0.3.html#transformation
         * 256 px * 2^4 = 4096 px
         */

        L.CRS.MySimple = L.extend({}, L.CRS.Simple, {
          //                      coefficients: a      b    c     d
          transformation: new L.Transformation(1 / 64, 0, 1 / 64, 0) // Compute a and c coefficients so that  tile 0/0/0 is from [0, 0] to [4096, 4096]
        });

        var bounds = L.latLngBounds([
          xy(0, 0),
          xy(img)
        ]);


//        var mapSW = [0, 16384],
//            mapNE = [16384, 0];

        var map = L.map('map', {
                          crs: L.CRS.MySimple, // http://leafletjs.com/reference-1.0.3.html#map-crs
                          maxBounds: bounds.pad(.5), // http://leafletjs.com/reference-1.0.3.html#map-maxbounds
                          minZoom: minZoom,
                          maxZoom: maxZoom
                        }).setView([0, 0], 1);
        
        L.tileLayer('dapi/{z}/{x}/{y}.png', {
            bounds: bounds,
            attribution: 'ESO/INAF-VST/OmegaCAM',
            continuousWorld: false,
            noWrap: true
        }).addTo(map);

//        map.setMaxBounds(new L.LatLngBounds(
//            map.unproject(mapSW, map.getMaxZoom()),
//            map.unproject(mapNE, map.getMaxZoom())
//            ))

        //Markers and popups
        //LatLng
        var marker = L.marker([0,0], {
            draggable: false,
        }).addTo(map);
        marker.bindPopup("");

//        marker.on('dragend', function(e) {
//            marker.getPopup().setContent('Clicked' + marker.getLatLng().toString() + '<br />'
//                + 'Pixels ' + map.project(marker.getLatLng(), map.getMaxZoom().toString()))
//            .openOn(map);
//        });
        
         ////////////////////////////////////////////////////////////////////////////
        // FlyTo
        ////////////////////////////////////////////////////////////////////////////

        var fly1 = document.getElementById("fly1");
        var fly2 = document.getElementById("fly2");
        var container = document.getElementById("container");

        fly1.addEventListener("click", function(event) {
          event.preventDefault();
          map.flyTo(xy(0, 0));
        });

        fly2.addEventListener("click", function(event) {
          event.preventDefault();
          map.flyTo(xy(img));
        });

        
         // add layer control object
        L.control.layers({}, {
          //'Polygon': layerPolygon(map), // no longer need for rc, using xy conversion instead
          //'Countries': layerCountries(map),
          'Bounds': layerBounds(map, img),
          //'Info': layerGeo(map)
        }, {
          collapsed: false
        }).addTo(map)
        
        
        /**
         * layer with markers
         */
        function layerBounds(map, img) {
          // set marker at the image bound edges
          var layerBounds = L.layerGroup([
            L.marker(xy([0, 0])).bindPopup('[0,0]'), // Just use xy conversion instead of rc.unproject
            L.marker(xy(img)).bindPopup(JSON.stringify(img)) // Just use xy conversion instead of rc.unproject
          ])
          map.addLayer(layerBounds)

          // set markers on click events in the map
          map.on('click', function(event) {
            // to obtain raster coordinates from the map use `project` => no longer needed!
            var coord = event.latlng;
            // to set a marker, ... in raster coordinates in the map use `unproject` => no longer needed!
            var marker = L.marker(coord)
              .addTo(layerBounds)
            marker.bindPopup(coord.toString() + "<br />x: " + coord.lng + "<br />y: " + coord.lat)
              .openPopup()
          })

          return layerBounds
        }


    </script>
</body>
</html